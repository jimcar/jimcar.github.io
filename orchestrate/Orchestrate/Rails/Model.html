<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Orchestrate::Rails::Model - Ruby / Orchestrate.io</title>

<link href="../../fonts.css" rel="stylesheet">
<link href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/navigation.js"></script>
<script src="../../js/search_index.js"></script>
<script src="../../js/search.js"></script>
<script src="../../js/searcher.js"></script>
<script src="../../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Application/Record.html">Orchestrate::Application::Record</a>
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">::ActiveModel::Validations</span>
  
  
  
    <li><span class="include">::ActiveModel::Conversion</span>
  
  
  </ul>
</div>

    <div id="extends-section" class="nav-section">
  <h3>Extended With Modules</h3>

  <ul class="link-list">
    
  
    <li><span class="extend">::ActiveModel::Naming</span>
  
  
  </ul>
</div>

    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-all">::all</a>
    
    <li ><a href="#method-c-attributes">::attributes</a>
    
    <li ><a href="#method-c-attrs">::attrs</a>
    
    <li ><a href="#method-c-create">::create</a>
    
    <li ><a href="#method-c-create-21">::create!</a>
    
    <li ><a href="#method-c-destroy">::destroy</a>
    
    <li ><a href="#method-c-destroy_all">::destroy_all</a>
    
    <li ><a href="#method-c-exists-3F">::exists?</a>
    
    <li ><a href="#method-c-find">::find</a>
    
    <li ><a href="#method-c-find_by">::find_by</a>
    
    <li ><a href="#method-c-find_by_method">::find_by_method</a>
    
    <li ><a href="#method-c-first">::first</a>
    
    <li ><a href="#method-c-last">::last</a>
    
    <li ><a href="#method-c-list">::list</a>
    
    <li class="calls-super" ><a href="#method-c-method_missing">::method_missing</a>
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-orchio_query_str">::orchio_query_str</a>
    
    <li ><a href="#method-c-properties">::properties</a>
    
    <li ><a href="#method-c-qmap">::qmap</a>
    
    <li class="calls-super" ><a href="#method-c-respond_to-3F">::respond_to?</a>
    
    <li ><a href="#method-c-schema">::schema</a>
    
    <li ><a href="#method-c-search">::search</a>
    
    <li ><a href="#method-c-search_results">::search_results</a>
    
    <li ><a href="#method-c-take">::take</a>
    
    <li ><a href="#method-c-where">::where</a>
    
    <li ><a href="#method-i-attributes">#attributes</a>
    
    <li ><a href="#method-i-attrs">#attrs</a>
    
    <li ><a href="#method-i-create_event">#create_event</a>
    
    <li ><a href="#method-i-define_attr_query">#define_attr_query</a>
    
    <li ><a href="#method-i-destroy">#destroy</a>
    
    <li ><a href="#method-i-destroy-21">#destroy!</a>
    
    <li ><a href="#method-i-events">#events</a>
    
    <li ><a href="#method-i-get">#get</a>
    
    <li ><a href="#method-i-get_by_ref">#get_by_ref</a>
    
    <li ><a href="#method-i-graph">#graph</a>
    
    <li ><a href="#method-i-orchestrate_collection_name">#orchestrate_collection_name</a>
    
    <li ><a href="#method-i-orchestrate_ref_value">#orchestrate_ref_value</a>
    
    <li ><a href="#method-i-retval">#retval</a>
    
    <li ><a href="#method-i-save">#save</a>
    
    <li ><a href="#method-i-save-21">#save!</a>
    
    <li ><a href="#method-i-save_event">#save_event</a>
    
    <li ><a href="#method-i-save_graph">#save_graph</a>
    
    <li ><a href="#method-i-save_if_match">#save_if_match</a>
    
    <li ><a href="#method-i-save_if_none_match">#save_if_none_match</a>
    
    <li ><a href="#method-i-to_json_direct">#to_json_direct</a>
    
    <li ><a href="#method-i-update_attribute">#update_attribute</a>
    
    <li ><a href="#method-i-update_attributes">#update_attributes</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Orchestrate::Rails::Model">
  <h1 id="class-Orchestrate::Rails::Model" class="class">
    class Orchestrate::Rails::Model
  </h1>

  <section class="description">
    
<p>Class to define rails models for Orchestrate.io DataBases-as-a-Service. The
library provides a base class that, when subclassed to define a model, sets
up a mapping between the model and an Orchestrate.io collection.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">all</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns ordered array of all instances in the collection.</p>
          
          

          
          <div class="method-source-code" id="all-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 327</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">all</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">list</span>
  (<span class="ruby-identifier">res</span>.<span class="ruby-identifier">success?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">results</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">attributes</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="attributes-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 277</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">attributes</span>
  <span class="ruby-identifier">new</span>.<span class="ruby-identifier">attributes</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-attrs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">attrs</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns array of model attribute names.</p>
          
          

          
          <div class="method-source-code" id="attrs-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 273</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">attrs</span>
  <span class="ruby-identifier">schema</span>.<span class="ruby-identifier">attrs</span> <span class="ruby-identifier">ocollection</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">(key_value_pairs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a new instance; updates the collection if the primary_key is not
already present in the collection.</p>

<p>Returns the instance upon success; false upon failure.</p>
          
          

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 301</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">key_value_pairs</span>)
  <span class="ruby-identifier">new</span>(<span class="ruby-identifier">key_value_pairs</span>).<span class="ruby-identifier">save_if_none_match</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-create-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create!</span><span
            class="method-args">(key_value_pairs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a new instance; updates the collection.</p>

<p>Returns the instance upon success; false upon failure.</p>
          
          

          
          <div class="method-source-code" id="create-21-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 308</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">key_value_pairs</span>)
  <span class="ruby-identifier">new</span>(<span class="ruby-identifier">key_value_pairs</span>).<span class="ruby-identifier">save!</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy</span><span
            class="method-args">(id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Delete the specified instance from the collection.</p>

<p>Returns boolean status.</p>
          
          

          
          <div class="method-source-code" id="destroy-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 315</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">new</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span>).<span class="ruby-identifier">destroy</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-destroy_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy_all</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Delete the entire collection.</p>

<p>Returns boolean status.</p>
          
          

          
          <div class="method-source-code" id="destroy_all-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 322</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">destroy_all</span>
  <span class="ruby-identifier">orchio_delete</span> <span class="ruby-identifier">ocollection</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-exists-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">exists?</span><span
            class="method-args">(id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns boolean to indicate whether the specified primary_key exists in the
collection.</p>
          
          

          
          <div class="method-source-code" id="exists-3F-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 351</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-find" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find</span><span
            class="method-args">(arg)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Find by the primary_key (id). Can be a specific id, or an array of ids.</p>

<p>Returns instance, or array of instances, accordingly.</p>
          
          

          
          <div class="method-source-code" id="find-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 358</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">arg</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Integer</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
    <span class="ruby-identifier">new</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">arg</span>).<span class="ruby-identifier">get</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Array</span>
    <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span> <span class="ruby-identifier">new</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span>).<span class="ruby-identifier">get</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-find_by" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_by</span><span
            class="method-args">(key_value_pairs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the first instance that matches the specified criteria.</p>
          
          

          
          <div class="method-source-code" id="find_by-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 372</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">key_value_pairs</span>)
  <span class="ruby-identifier">where</span>(<span class="ruby-identifier">key_value_pairs</span>).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-find_by_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_by_method</span><span
            class="method-args">(myattrs, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Calls <a href="Model.html#method-c-find_by">::find_by</a> for properly
constructed &#39;find_by_attribute(s)&#39; calls.</p>

<p>Example: <code>User.find_by_name_and_address(name, address)</code> is
executed as:</p>

<p><code>User.find_by(:name =&gt; name, :address =&gt; address)</code></p>
          
          

          
          <div class="method-source-code" id="find_by_method-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 382</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_by_method</span>(<span class="ruby-identifier">myattrs</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">attrs_with_args</span> = [<span class="ruby-identifier">myattrs</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;_and_&#39;</span>), <span class="ruby-identifier">args</span>].<span class="ruby-identifier">transpose</span>
  <span class="ruby-identifier">attrs_with_args</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">awa</span><span class="ruby-operator">|</span> <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">awa</span>.<span class="ruby-identifier">first</span> }
  <span class="ruby-identifier">find_by</span> <span class="ruby-constant">Hash</span>[<span class="ruby-identifier">attr_with_args</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-first" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">first</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the first (ordered) instance in the collection.</p>
          
          

          
          <div class="method-source-code" id="first-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 333</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">list</span>(<span class="ruby-value">1</span>)
  (<span class="ruby-identifier">res</span>.<span class="ruby-identifier">success?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-last" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">last</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the last (ordered) instance in the collection.</p>
          
          

          
          <div class="method-source-code" id="last-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 339</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">all</span>.<span class="ruby-identifier">last</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">list</span><span
            class="method-args">(limit=:all, start_key=nil, after_key=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns <a
href="../Application/Result.html">Orchestrate::Application::Result</a>.</p>

<p>The start index may be optionally specified by using either start_key
(inclusive) or after_key (exclusive). The default is the first primary key
in the collection.</p>
          
          

          
          <div class="method-source-code" id="list-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 447</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">list</span>(<span class="ruby-identifier">limit</span>=<span class="ruby-value">:all</span>, <span class="ruby-identifier">start_key</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">after_key</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">limit</span> <span class="ruby-operator">==</span> <span class="ruby-value">:all</span>
    <span class="ruby-identifier">total_count</span> = <span class="ruby-value">0</span>
    <span class="ruby-identifier">max</span> = <span class="ruby-value">100</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">orchio_list</span> <span class="ruby-identifier">ocollection</span>, <span class="ruby-node">&quot;?limit=#{max}&quot;</span>
    <span class="ruby-identifier">count</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">count</span>
    <span class="ruby-identifier">docs</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">results</span>
    <span class="ruby-keyword">while</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">next</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-identifier">orchio_list</span> <span class="ruby-identifier">ocollection</span>, <span class="ruby-node">&quot;?#{result.next.split(&#39;?&#39;).last}&quot;</span>
      <span class="ruby-identifier">docs</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">results</span>
      <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">count</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-constant">Orchestrate</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span><span class="ruby-operator">::</span><span class="ruby-constant">Result</span>.<span class="ruby-identifier">new</span>(
      <span class="ruby-identifier">results</span><span class="ruby-operator">:</span>  <span class="ruby-identifier">docs</span>,
      <span class="ruby-identifier">count</span><span class="ruby-operator">:</span>    <span class="ruby-identifier">count</span>,
      <span class="ruby-identifier">status</span><span class="ruby-operator">:</span>   <span class="ruby-identifier">result</span>.<span class="ruby-identifier">status</span>,
      <span class="ruby-identifier">response</span><span class="ruby-operator">:</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">response</span>
    )
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">option_str</span> = <span class="ruby-node">&quot;?limit=#{limit}&quot;</span>
    <span class="ruby-identifier">option_str</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;startKey=#{start_key}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">start_key</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">after_key</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">option_str</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;afterKey=#{after_key}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">after_key</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">start_key</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">orchio_list</span> <span class="ruby-identifier">ocollection</span>, <span class="ruby-identifier">option_str</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">odoc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">odoc</span>.<span class="ruby-identifier">to_rails</span> }
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-method_missing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">method_missing</span><span
            class="method-args">(name, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Calls <a href="Model.html#method-c-find_by_method">::find_by_method</a> for
&#39;find_by_attribute(s)&#39;.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="method_missing-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 389</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">method_missing</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^find_by_(.+)$/</span>
    <span class="ruby-identifier">find_by_method</span>(<span class="ruby-node">$1</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword">super</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">super</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(params={})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates instance variable for each model attribute defined by the schema.
Initializes any attribute values that are passed in via the params hash and
then initializes the @attributes instance variable.</p>

<p>Any key/value pair in params whose key is not an attribute (i.e. :id or
:define_collection_name) is passed on to the superclass.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="../Application/Record.html#method-c-new">Orchestrate::Application::Record.new</a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 23</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">params</span>={})<span class="ruby-keyword">super</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-comment"># Define accessor and query methods for each attribute.</span>
  <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attribute</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:attr_accessor</span>, <span class="ruby-identifier">attribute</span>
    <span class="ruby-identifier">define_attr_query</span> <span class="ruby-identifier">attribute</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Set instance variables and initialize @attributes with any</span>
  <span class="ruby-comment"># attribute values that were passed in the params hash.</span>
  <span class="ruby-ivar">@attributes</span> = {}
  <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{k}=&quot;</span>, <span class="ruby-identifier">v</span>)
      <span class="ruby-ivar">@attributes</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-properties" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">properties</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns array of property names.</p>

<p>Property names are the original key names in json documents stored in
orchestrate collections - before they are converted to the snake_case style
used for model attribute names. Attribute names are mapped to property
names using <a href="Model.html#method-c-qmap">::qmap</a>. Property names
can be mapped to attribute names with <a
href="../../Symbol.html#method-i-to_orchio_rails_attr">Symbol#to_orchio_rails_attr</a>
or <a
href="../../String.html#method-i-to_orchio_rails_attr">String#to_orchio_rails_attr</a>.</p>
          
          

          
          <div class="method-source-code" id="properties-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 290</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">properties</span>
  <span class="ruby-identifier">schema</span>.<span class="ruby-identifier">properties</span> <span class="ruby-identifier">ocollection</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-qmap" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">qmap</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the table that maps attribute names to property names.</p>

<p>This mapping also works when the input is a property name.</p>
          
          

          
          <div class="method-source-code" id="qmap-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 268</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">qmap</span>
  <span class="ruby-identifier">schema</span>.<span class="ruby-identifier">qmap</span> <span class="ruby-identifier">ocollection</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-respond_to-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">respond_to?</span><span
            class="method-args">(name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Handles find_by_attribute methods.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="respond_to-3F-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 398</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">name</span>)
  (<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^find_by_.*$/</span>) <span class="ruby-keyword">or</span> <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">(query_str, limit=:all, offset=0)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns <a href="SearchResult.html">SearchResult</a>. Orchestrate.io search
implements Lucene Query Parser Syntax.</p>
          
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 412</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">query_str</span>, <span class="ruby-identifier">limit</span>=<span class="ruby-value">:all</span>, <span class="ruby-identifier">offset</span>=<span class="ruby-value">0</span>)
  <span class="ruby-identifier">query_str</span> = <span class="ruby-identifier">orchio_query_str</span>(<span class="ruby-identifier">query_str</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">query_str</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;*&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">limit</span> <span class="ruby-operator">==</span> <span class="ruby-value">:all</span>
    <span class="ruby-identifier">total_count</span> = <span class="ruby-identifier">offset</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">max</span> = <span class="ruby-value">100</span>
    <span class="ruby-identifier">qdocs</span> = []
    <span class="ruby-keyword">while</span> <span class="ruby-identifier">offset</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">total_count</span>
      <span class="ruby-identifier">qresult</span> = <span class="ruby-identifier">orchio_search</span>(
        <span class="ruby-identifier">ocollection</span>, <span class="ruby-node">&quot;#{query_str}&amp;limit=#{max}&amp;offset=#{offset}&quot;</span>
      )
      <span class="ruby-identifier">offset</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">qresult</span>.<span class="ruby-identifier">count</span>
      <span class="ruby-identifier">total_count</span> = <span class="ruby-identifier">qresult</span>.<span class="ruby-identifier">total_count</span>
      <span class="ruby-identifier">qdocs</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">qresult</span>.<span class="ruby-identifier">results</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">qresult</span> = <span class="ruby-constant">SearchResult</span>.<span class="ruby-identifier">new</span>(
      <span class="ruby-identifier">results</span><span class="ruby-operator">:</span>     <span class="ruby-identifier">qdocs</span>,
      <span class="ruby-identifier">count</span><span class="ruby-operator">:</span>       <span class="ruby-identifier">offset</span>,
      <span class="ruby-identifier">total_count</span><span class="ruby-operator">:</span> <span class="ruby-identifier">total_count</span>,
      <span class="ruby-identifier">status</span><span class="ruby-operator">:</span>      <span class="ruby-identifier">qresult</span>.<span class="ruby-identifier">status</span>,
      <span class="ruby-identifier">response</span><span class="ruby-operator">:</span>    <span class="ruby-identifier">qresult</span>.<span class="ruby-identifier">response</span>
    )
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">qresult</span> = <span class="ruby-identifier">orchio_search</span>(
      <span class="ruby-identifier">ocollection</span>, <span class="ruby-node">&quot;#{query_str}&amp;limit=#{limit}&amp;offset=#{offset}&quot;</span>
    )
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">qresult</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">odoc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">odoc</span>.<span class="ruby-identifier">to_rails</span> }
  <span class="ruby-identifier">qresult</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-search_results" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_results</span><span
            class="method-args">(query_str)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns array of model instances that match the query string.</p>
          
          

          
          <div class="method-source-code" id="search_results-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 405</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">search_results</span>(<span class="ruby-identifier">query_str</span>)
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">search</span>(<span class="ruby-identifier">query_str</span>)
  (<span class="ruby-identifier">res</span>.<span class="ruby-identifier">success?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">results</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-take" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">take</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the first (random) instance in the collection.</p>
          
          

          
          <div class="method-source-code" id="take-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 344</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">take</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">search</span>(<span class="ruby-string">&#39;*&#39;</span>, <span class="ruby-value">1</span>)
  (<span class="ruby-identifier">res</span>.<span class="ruby-identifier">success?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-where" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">where</span><span
            class="method-args">(key_value_pairs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns all instances that match the specified criteria.</p>
          
          

          
          <div class="method-source-code" id="where-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 367</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">key_value_pairs</span>)
  <span class="ruby-identifier">search</span>(<span class="ruby-identifier">key_value_pairs</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{k}:#{v}&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; AND &#39;</span>)).<span class="ruby-identifier">results</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Class Methods</h3>
       </header>

    
      <div id="method-c-orchio_query_str" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">orchio_query_str</span><span
            class="method-args">(query_str)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an orchestrate-ready query string for the search request. The
attribute names used by the model are replaced with the property names used
in the collection.</p>
          
          

          
          <div class="method-source-code" id="orchio_query_str-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 493</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">orchio_query_str</span>(<span class="ruby-identifier">query_str</span>)
  <span class="ruby-identifier">keys</span> = <span class="ruby-identifier">query_str</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/^(\w+):/</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">first</span> } <span class="ruby-operator">+</span>
         <span class="ruby-identifier">query_str</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s(\w+):/</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">first</span> }
  <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">query_str</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/#{k}:/</span>, <span class="ruby-node">&quot;#{qmap[k]}:&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">qmap</span>[<span class="ruby-identifier">k</span>] }
  <span class="ruby-identifier">query_str</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-schema" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">schema</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns handle to the <a href="Schema.html">Schema</a> singleton instance.</p>
          
          

          
          <div class="method-source-code" id="schema-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 486</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">schema</span>
  <span class="ruby-identifier">@@schema</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Schema</span>.<span class="ruby-identifier">instance</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">attributes</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns hash of key/value pairs.</p>
          
          

          
          <div class="method-source-code" id="attributes-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 50</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">attributes</span>
  <span class="ruby-ivar">@attributes</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">a</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{a}&quot;</span>)] }]
  <span class="ruby-comment"># @attributes =</span>
  <span class="ruby-comment">#   Hash[attrs.map { |a| [a.to_sym, instance_variable_get(&quot;@#{a}&quot;)] }]</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-attrs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">attrs</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns array of model attribute names.</p>
          
          

          
          <div class="method-source-code" id="attrs-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">attrs</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">attrs</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_event" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_event</span><span
            class="method-args">(event_type, timestamp=nil, event_rec)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates event instance; calls <a
href="Model.html#method-i-save_event">save_event</a> to update the
collection.</p>

<p>Returns the event instance upon success; false upon failure.</p>
          
          

          
          <div class="method-source-code" id="create_event-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 205</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_event</span>(<span class="ruby-identifier">event_type</span>, <span class="ruby-identifier">timestamp</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">event_rec</span>)
  <span class="ruby-identifier">save_event</span> <span class="ruby-identifier">event_type</span>, <span class="ruby-identifier">timestamp</span>, <span class="ruby-constant">Event</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">event_rec</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Deletes the current primary_key from the collection.</p>

<p>Returns boolean status.</p>
          
          

          
          <div class="method-source-code" id="destroy-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 165</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy</span>
  <span class="ruby-identifier">orchio_delete</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-destroy-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Deletes the current primary_key and <strong>purges all of its immutable
data</strong> from the collection.</p>

<p>Returns boolean status.</p>
          
          

          
          <div class="method-source-code" id="destroy-21-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy!</span>
  <span class="ruby-identifier">orchio_purge</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-events" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">events</span><span
            class="method-args">(event_type, timestamp={})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns array of event instances specified by event_type and timestamp
range,</p>

<p>where the timestamp range is specified as { :start =&gt; start, :end =&gt;
end }</p>
          
          

          
          <div class="method-source-code" id="events-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">events</span>(<span class="ruby-identifier">event_type</span>, <span class="ruby-identifier">timestamp</span>={})
  <span class="ruby-comment"># orchio_get_events(event_type, timestamp).results.map { |odoc| odoc.to_event }</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">orchio_get_events</span>(<span class="ruby-identifier">event_type</span>, <span class="ruby-identifier">timestamp</span>)
  (<span class="ruby-identifier">res</span>.<span class="ruby-identifier">success?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">odoc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">odoc</span>.<span class="ruby-identifier">to_event</span> } <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the key/value data for the current instance.</p>
          
          

          
          <div class="method-source-code" id="get-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">orchio_get</span>
  (<span class="ruby-identifier">res</span>.<span class="ruby-identifier">success?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">result</span>.<span class="ruby-identifier">update_rails</span>(<span class="ruby-keyword">self</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_by_ref" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_by_ref</span><span
            class="method-args">(ref)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the key/value data for the current instance, found by
<code>ref</code> value.</p>
          
          

          
          <div class="method-source-code" id="get_by_ref-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_by_ref</span>(<span class="ruby-identifier">ref</span>)
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">orchio_get_by_ref</span> <span class="ruby-identifier">ref</span>
  (<span class="ruby-identifier">res</span>.<span class="ruby-identifier">success?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">result</span>.<span class="ruby-identifier">update_rails</span>(<span class="ruby-keyword">self</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-graph" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">graph</span><span
            class="method-args">(kind)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns array of instances associated with the specified kind of relation.</p>
          
          

          
          <div class="method-source-code" id="graph-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">graph</span>(<span class="ruby-identifier">kind</span>)
  <span class="ruby-comment"># orchio_get_graph(kind).results.map { |odoc| odoc.to_rails }</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">orchio_get_graph</span>(<span class="ruby-identifier">kind</span>)
  (<span class="ruby-identifier">res</span>.<span class="ruby-identifier">success?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">odoc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">odoc</span>.<span class="ruby-identifier">to_rails</span> } <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-orchestrate_collection_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">orchestrate_collection_name</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the collection name for the current instance.</p>
          
          

          
          <div class="method-source-code" id="orchestrate_collection_name-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">orchestrate_collection_name</span>
  <span class="ruby-identifier">ocollection</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-orchestrate_ref_value" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">orchestrate_ref_value</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the <code>ref</code> value for the current instance. The
<code>ref</code> value is an immutable value assigned to each version of
primary_key data in an orchestrate.io collection.</p>
          
          

          
          <div class="method-source-code" id="orchestrate_ref_value-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">orchestrate_ref_value</span>
  <span class="ruby-identifier">__ref_value__</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Calls <a href="Model.html#method-i-save_if_match">save_if_match</a>.</p>
          
          

          
          <div class="method-source-code" id="save-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save</span>
  <span class="ruby-identifier">save_if_match</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates the collection with current instance data.</p>

<p>Returns the instance upon success; false upon failure.</p>
          
          

          
          <div class="method-source-code" id="save-21-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 131</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save!</span>
  <span class="ruby-identifier">status</span> = <span class="ruby-identifier">orchio_put</span>(<span class="ruby-identifier">to_json_direct</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">valid?</span>
  <span class="ruby-identifier">retval</span> <span class="ruby-identifier">status</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save_event" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_event</span><span
            class="method-args">(event_type, timestamp=nil, event)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates the collection with the specified event instance.</p>

<p>Returns the event instance upon success; false upon failure.</p>
          
          

          
          <div class="method-source-code" id="save_event-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_event</span>(<span class="ruby-identifier">event_type</span>, <span class="ruby-identifier">timestamp</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">event</span>)
  <span class="ruby-identifier">retval</span> <span class="ruby-identifier">orchio_put_event</span>(<span class="ruby-identifier">event_type</span>, <span class="ruby-identifier">timestamp</span>, <span class="ruby-identifier">event</span>.<span class="ruby-identifier">to_json</span>), <span class="ruby-identifier">event</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save_graph" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_graph</span><span
            class="method-args">(kind, to_collection, to_key)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates the collection with the specified graph relation.</p>

<p>Returns boolean status.</p>
          
          

          
          <div class="method-source-code" id="save_graph-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_graph</span>(<span class="ruby-identifier">kind</span>, <span class="ruby-identifier">to_collection</span>, <span class="ruby-identifier">to_key</span>)
  <span class="ruby-identifier">retval</span> <span class="ruby-identifier">orchio_put_graph</span> <span class="ruby-identifier">kind</span>, <span class="ruby-identifier">to_collection</span>, <span class="ruby-identifier">to_key</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save_if_match" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_if_match</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates the collection with current instance data, if the <code>ref</code>
value matches the <code>ref</code> value associated with the same
primary_key in the collection.</p>

<p>Returns the instance upon success; false upon failure.</p>
          
          

          
          <div class="method-source-code" id="save_if_match-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 118</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_if_match</span>
  <span class="ruby-identifier">status</span> = <span class="ruby-identifier">orchio_put_if_match</span>(<span class="ruby-identifier">to_json_direct</span>, <span class="ruby-identifier">__ref_value__</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">valid?</span>
  <span class="ruby-identifier">retval</span> <span class="ruby-identifier">status</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save_if_none_match" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_if_none_match</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates the collection with current instance data, if the primary_key (id)
does not exist in the collection.</p>

<p>Returns the instance upon success; false upon failure.</p>
          
          

          
          <div class="method-source-code" id="save_if_none_match-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 107</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_if_none_match</span>
  <span class="ruby-identifier">status</span> = <span class="ruby-identifier">orchio_put_if_none_match</span>(<span class="ruby-identifier">to_json_direct</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">valid?</span>
  <span class="ruby-identifier">retval</span> <span class="ruby-identifier">status</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_attribute" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_attribute</span><span
            class="method-args">(key, value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates the attribute and calls <a
href="Model.html#method-i-save_if_match">save_if_match</a>.</p>
          
          

          
          <div class="method-source-code" id="update_attribute-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 137</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_attribute</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">instance_variable_set</span> <span class="ruby-node">&quot;@#{key}&quot;</span>, <span class="ruby-identifier">value</span>
  <span class="ruby-identifier">save_if_match</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_attributes</span><span
            class="method-args">(key_value_pairs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates the attributes and calls <a
href="Model.html#method-i-save_if_match">save_if_match</a>.</p>
          
          

          
          <div class="method-source-code" id="update_attributes-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 143</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">key_value_pairs</span>)
  <span class="ruby-identifier">key_value_pairs</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">instance_variable_set</span> <span class="ruby-node">&quot;@#{k}&quot;</span>, <span class="ruby-identifier">v</span> }
  <span class="ruby-identifier">save_if_match</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-define_attr_query" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">define_attr_query</span><span
            class="method-args">(attribute)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Defines query method to test whether the attribute value is present.</p>
          
          

          
          <div class="method-source-code" id="define_attr_query-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 236</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">define_attr_query</span>(<span class="ruby-identifier">attribute</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:define_method</span>, <span class="ruby-node">&quot;#{attribute}?&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-operator">!</span><span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-node">&quot;@#{attribute}&quot;</span>).<span class="ruby-identifier">blank?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-retval" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">retval</span><span
            class="method-args">(status, obj=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="retval-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 81</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">retval</span>(<span class="ruby-identifier">status</span>, <span class="ruby-identifier">obj</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    (<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">blank?</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword">self</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">obj</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">status</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_json_direct" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_json_direct</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Generates json for the attribute key/value pairs, replacing attribute names
used by the model with the property names used in the collection.</p>
          
          

          
          <div class="method-source-code" id="to_json_direct-source">
            <pre><span class="ruby-comment"># File rails/lib/orchestrate_rails/model.rb, line 245</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_json_direct</span>
  <span class="ruby-constant">Hash</span>[<span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">qmap</span>[<span class="ruby-identifier">a</span>], <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-node">&quot;@#{a}&quot;</span>)] }].<span class="ruby-identifier">to_json</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

